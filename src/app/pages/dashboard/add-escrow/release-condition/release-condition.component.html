<div class="container mt-4">
    <h5>Choose the agreed-upon conditions between you and your counterparty.</h5>
    <div class="mb-3">
        <label><strong>Upload Document</strong></label>
        <input #fileInput type="file" class="form-control" (change)="onFileUpload($event, fileInput)" />
          <app-show-errors [ctrl]="releaseForm.get('document')"
            [requiredMesg]="'Document is required'">
        </app-show-errors>
        <small class="text-muted">File size must be less than 5MB</small>

        <p class="mb-1" *ngIf="releaseForm.get('document')?.value">
            <a [href]="releaseForm.get('document')?.value" target="_blank" class="text-decoration-none">
                üëÅÔ∏è View Uploaded Document
            </a>
            <button type="button" class="btn btn-outline-danger btn-sm"
                (click)="removeUploadedDocument()">
                Remove
            </button>
        </p>
    </div>
    <div class="row g-3">
        <div class="col-md-6 mb-3" *ngFor="let opt of allOptions">
            <div class="p-3 border rounded position-relative" [ngClass]="{'border-primary': isSelected(opt.key)}"
                style="cursor: pointer;" (click)="toggleOption(opt.key)">
                <div class="d-flex align-items-center gap-3">
                    <img [src]="opt.icon" width="40" />
                    <div>
                        <h6 class="mb-1">{{ opt.label }}</h6>
                        <p class="text-muted small mb-0">{{ opt.description }}</p>
                    </div>
                </div>
                <input type="checkbox" class="form-check-input position-absolute top-0 end-0 m-3"
                    [checked]="isSelected(opt.key)" readonly />
                <button *ngIf="opt.isCustom" type="button"
                    class="btn btn-sm btn-outline-danger position-absolute bottom-0 end-0 m-3"
                    (click)="removeCustom(opt.key)">Delete</button>
            </div>
        </div>
        <app-show-errors [ctrl]="releaseForm.get('release_conditions')"
            [requiredMesg]="'At least one condition is required'">
        </app-show-errors>
    </div>
    <div class="mt-3">
        <button class="btn btn-outline-primary" type="button" (click)="openCustomModal(customConditionModal)">Add New
            Custom
            Condition</button>
    </div>
</div>

<div class="mt-4">
    <button class="btn btn-primary" (click)="onSubmit()">Submit</button>
</div>
<ng-template #customConditionModal let-modal>
    <form [formGroup]="customForm" class="p-3">
        <h6>Add Custom Condition</h6>
        <div class="mb-2">
            <input formControlName="title" class="form-control" placeholder="Custom Title" />
            <app-show-errors [ctrl]="customForm.get('title')" [requiredMesg]="'Title is required'"></app-show-errors>
        </div>
        <div class="mb-2">
            <textarea formControlName="description" class="form-control" rows="2"
                placeholder="Custom Description"></textarea>
            <app-show-errors [ctrl]="customForm.get('description')"
                [requiredMesg]="'Description is required'"></app-show-errors>
        </div>
        <div class="d-flex justify-content-end">
            <button class="btn btn-sm btn-primary" type="button" (click)="addCustom(modal)"
                [disabled]="customForm.invalid">
                Add Condition
            </button>
            <button class="btn btn-sm btn-outline-secondary ms-2" type="button"
                (click)="modal.dismiss()">Cancel</button>
        </div>
    </form>
</ng-template>